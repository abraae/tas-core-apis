<!DOCTYPE HTML><html><head><title>TAS core incoming (app -> TAS) API documentation</title><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="generator" content="https://github.com/kevinrenskers/raml2html 2.0.2"><link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/default.min.css"><script type="text/javascript" src="https://code.jquery.com/jquery-1.11.0.min.js"></script><script type="text/javascript" src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/highlight.min.js"></script><script type="text/javascript">
      $(document).ready(function() {
        $('.page-header pre code, .top-resource-description pre code').each(function(i, block) {
          hljs.highlightBlock(block);
        });

        $('[data-toggle]').click(function() {
          var selector = $(this).data('target') + ' pre code';
          $(selector).each(function(i, block) {
            hljs.highlightBlock(block);
          });
        });

        // open modal on hashes like #_action_get
        $(window).bind('hashchange', function(e) {
          var anchor_id = document.location.hash.substr(1); //strip #
          var element = $('#' + anchor_id);

          // do we have such element + is it a modal?  --> show it
          if (element.length && element.hasClass('modal')) {
            element.modal('show');
          }
        });

        // execute hashchange on first page load
        $(window).trigger('hashchange');

        // remove url fragment on modal hide
        $('.modal').on('hidden.bs.modal', function() {
          if(history && history.replaceState) {
            history.replaceState({}, '', '#');
          }
        });
      });
    </script><style>
      .hljs {
        background: transparent;
      }
      .parent {
        color: #999;
      }
      .list-group-item > .badge {
        float: none;
        margin-right: 6px;
      }
      .panel-title > .methods {
        float: right;
      }
      .badge {
        border-radius: 0;
        text-transform: uppercase;
        width: 70px;
        font-weight: normal;
        color: #f3f3f6;
        line-height: normal;
      }
      .badge_get {
        background-color: #63a8e2;
      }
      .badge_post {
        background-color: #6cbd7d;
      }
      .badge_put {
        background-color: #22bac4;
      }
      .badge_delete {
        background-color: #d26460;
      }
      .badge_patch {
        background-color: #ccc444;
      }
      .list-group, .panel-group {
        margin-bottom: 0;
      }
      .panel-group .panel+.panel-white {
        margin-top: 0;
      }
      .panel-group .panel-white {
        border-bottom: 1px solid #F5F5F5;
        border-radius: 0;
      }
      .panel-white:last-child {
        border-bottom-color: white;
        -webkit-box-shadow: none;
        box-shadow: none;
      }
      .panel-white .panel-heading {
        background: white;
      }
      .tab-pane ul {
        padding-left: 2em;
      }
      .tab-pane h2 {
        font-size: 1.2em;
        padding-bottom: 4px;
        border-bottom: 1px solid #ddd;
      }
      .tab-pane h3 {
        font-size: 1.1em;
      }
      .tab-content {
        border-left: 1px solid #ddd;
        border-right: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        padding: 10px;
      }
      #sidebar {
        margin-top: 30px;
        padding-right: 5px;
        overflow: auto;
        height: 90%;
      }
      .top-resource-description {
        border-bottom: 1px solid #ddd;
        background: #fcfcfc;
        padding: 15px 15px 0 15px;
        margin: -15px -15px 10px -15px;
      }
      .resource-description {
        border-bottom: 1px solid #fcfcfc;
        background: #fcfcfc;
        padding: 15px 15px 0 15px;
        margin: -15px -15px 10px -15px;
      }
      .resource-description p:last-child {
        margin: 0;
      }
      .list-group .badge {
        float: left;
      }
      .method_description {
        margin-left: 85px;
      }
      .method_description p:last-child {
        margin: 0;
      }
      .list-group-item {
        cursor: pointer;
      }
      .list-group-item:hover {
        background-color: #f5f5f5;
      }
    </style></head><body data-spy="scroll" data-target="#sidebar"><div class="container"><div class="row"><div class="col-md-9" role="main"><div class="page-header"><h1>TAS core incoming (app -> TAS) API documentation <small>version v1</small></h1><p>http://core.talentappstore.com/api/v1</p><h3 id="Welcome"><a href="#Welcome">Welcome</a></h3><p>You&#39;re at the documentation for the Talent App Store (TAS) <strong>core-in APIs</strong>. See also the <a href="coreOut.raml.html">core-out APIs</a> and the <a href="../index.html">index</a> of all core API documentation, including RAML files, json schemas and API examples.</p><p>For a higher level view of TAS, and writing apps, go to the <a href="http://developer.talentappstore.com">developer site</a>.</p><h3 id="About-TAS-APIs"><a href="#About-TAS-APIs">About TAS APIs</a></h3><p>TAS deals in two types of APIs.</p><p>Core APIs are used by apps to talk to the core (i.e., core-in APIs) or vice versa (core-out APIs). The TAS core APIs are mainly used by apps to:</p><ul><li>handle provisioning (when tenants install or uninstall your app)</li><li>provide single sign on (SSO)</li><li>produce and consume tenant APIs (on other apps)</li></ul><p>Almost all core API calls are secured using <a href="../doc/HMAC.html">HMAC</a>.</p><p>Tenant APIs are used by apps to talk to other apps on behalf of a tenant - for example, a job board fetching a list of open jobs from an applicant tracking system (ATS) app.</p><p>Tenant APIs are defined by developers, and not controlled in any way by TAS. However we do provide some best practice suggestion on how developers should <a href="../doc/versioning.html">version tenant APIs</a>.</p></div><div class="panel panel-default"><div class="panel-heading"><h3 id="OAuthPublicKey" class="panel-title">/OAuthPublicKey</h3></div><div class="panel-body"><div class="top-resource-description"><p>The <em>OAuth public key</em> is used by apps to verify that incoming OAuth tokens were indeed issued by TAS.</p></div><div class="panel-group"><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_OAuthPublicKey"><span class="parent"></span>/OAuthPublicKey</a> <span class="methods"><a href="#OAuthPublicKey_get"><span class="badge badge_get">get</span></a></span></h4></div><div id="panel_OAuthPublicKey" class="panel-collapse collapse"><div class="panel-body"><div class="list-group"><div onclick="window.location.href = '#OAuthPublicKey_get'" class="list-group-item"><span class="badge badge_get">get</span><div class="method_description"><p>Get the current public key used by TASA to sign OAuth tokens.</p></div><div class="clearfix"></div></div></div></div></div><div class="modal fade" tabindex="0" id="OAuthPublicKey_get"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel"><span class="badge badge_get">get</span> <span class="parent"></span>/OAuthPublicKey</h4></div><div class="modal-body"><div class="alert alert-info"><p>Get the current public key used by TASA to sign OAuth tokens.</p></div><ul class="nav nav-tabs"><li><a href="#OAuthPublicKey_get_response" data-toggle="tab">Response</a></li></ul><div class="tab-content"><div class="tab-pane" id="OAuthPublicKey_get_response"><h2>HTTP status code <a href="http://httpstatus.es/200" target="_blank">200</a></h2><h3>Body</h3><p><strong>Type: text/plain</strong></p><p><strong>Example</strong>:</p><pre><code>MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBoCtyhZycRSAQ5aqYMESTSAFr0lwIDAQAB</code></pre></div></div></div></div></div></div></div></div></div></div><div class="panel panel-default"><div class="panel-heading"><h3 id="patchSets" class="panel-title">/patchSets</h3></div><div class="panel-body"><div class="panel-group"><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_patchSets"><span class="parent"></span>/patchSets</a> <span class="methods"><a href="#patchSets_post"><span class="badge badge_post">post</span></a></span></h4></div><div id="panel_patchSets" class="panel-collapse collapse"><div class="panel-body"><div class="list-group"><div onclick="window.location.href = '#patchSets_post'" class="list-group-item"><span class="badge badge_post">post</span><div class="method_description"><p>This endpoint behaves exactly as per /tenants/{tenant}/patchSets, except that it creates a tenant rather than applying patches to an existing tenant.</p><p>The core asserts that:</p><ul><li>the app is marked as "storeFront"</li></ul></div><div class="clearfix"></div></div></div></div></div><div class="modal fade" tabindex="0" id="patchSets_post"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel"><span class="badge badge_post">post</span> <span class="parent"></span>/patchSets</h4></div><div class="modal-body"><div class="alert alert-info"><p>This endpoint behaves exactly as per /tenants/{tenant}/patchSets, except that it creates a tenant rather than applying patches to an existing tenant.</p><p>The core asserts that:</p><ul><li>the app is marked as "storeFront"</li></ul></div><ul class="nav nav-tabs"></ul><div class="tab-content"></div></div></div></div></div></div><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_patchSets__launchKey_"><span class="parent">/patchSets</span>/{launchKey}</a> <span class="methods"><a href="#patchSets__launchKey__post"><span class="badge badge_post">post</span></a></span></h4></div><div id="panel_patchSets__launchKey_" class="panel-collapse collapse"><div class="panel-body"><div class="list-group"><div onclick="window.location.href = '#patchSets__launchKey__post'" class="list-group-item"><span class="badge badge_post">post</span><div class="method_description"><p>This endpoint behaves exactly as per /tenants/{tenant}/patchSets/{launchKey}, except that it works against a tenant-creating patchSet, rather than a patchSet that is modifying an existing tenant.</p><p>The core asserts that:</p><ul><li>the app is marked as "storeFront"</li></ul></div><div class="clearfix"></div></div></div></div></div><div class="modal fade" tabindex="0" id="patchSets__launchKey__post"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel"><span class="badge badge_post">post</span> <span class="parent">/patchSets</span>/{launchKey}</h4></div><div class="modal-body"><div class="alert alert-info"><p>This endpoint behaves exactly as per /tenants/{tenant}/patchSets/{launchKey}, except that it works against a tenant-creating patchSet, rather than a patchSet that is modifying an existing tenant.</p><p>The core asserts that:</p><ul><li>the app is marked as "storeFront"</li></ul></div><ul class="nav nav-tabs"><li class="active"><a href="#patchSets__launchKey__post_request" data-toggle="tab">Request</a></li></ul><div class="tab-content"><div class="tab-pane active" id="patchSets__launchKey__post_request"><h3>URI Parameters</h3><ul><li><strong>launchKey</strong>: <em>required (string)</em></li></ul></div></div></div></div></div></div></div></div></div></div><div class="panel panel-default"><div class="panel-heading"><h3 id="ping" class="panel-title">/ping</h3></div><div class="panel-body"><div class="top-resource-description"><p>A ping is the simplest call an app can make against the TAS core</p></div><div class="panel-group"><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_ping"><span class="parent"></span>/ping</a> <span class="methods"><a href="#ping_get"><span class="badge badge_get">get</span></a></span></h4></div><div id="panel_ping" class="panel-collapse collapse"><div class="panel-body"><div class="list-group"><div onclick="window.location.href = '#ping_get'" class="list-group-item"><span class="badge badge_get">get</span><div class="method_description"><p>Always return http 200. Useful for testing app is working OK (has correct secret key etc.).</p></div><div class="clearfix"></div></div></div></div></div><div class="modal fade" tabindex="0" id="ping_get"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel"><span class="badge badge_get">get</span> <span class="parent"></span>/ping</h4></div><div class="modal-body"><div class="alert alert-info"><p>Always return http 200. Useful for testing app is working OK (has correct secret key etc.).</p></div><ul class="nav nav-tabs"><li><a href="#ping_get_response" data-toggle="tab">Response</a></li></ul><div class="tab-content"><div class="tab-pane" id="ping_get_response"><h2>HTTP status code <a href="http://httpstatus.es/200" target="_blank">200</a></h2></div></div></div></div></div></div></div></div></div></div><div class="panel panel-default"><div class="panel-heading"><h3 id="routes" class="panel-title">/routes</h3></div><div class="panel-body"><div class="top-resource-description"><h2 id="about-routes">About routes</h2><p>Routes reflect a possible point to point API call between two apps on behalf of a tenant. They are usages:</p><ul><li>of a tenant API</li><li>as produced in a specific way (source of truth or not)</li><li>by a consuming app</li><li>installed at a tenant</li><li>on a producing app (currently, always the same as the consuming tenant)</li><li>installed at a tenant</li></ul><p>To consume a tenant API, the consuming app must first fetch a route in order to locate the actual endpoint (where the producer&#39;s server sits on the internet).</p><p>Routes are also useful to the producer of an API, e.g. to validate the methods (POST, GET, etc.) that the consumer is allowed to call.</p><h2 id="remote-mounting">Remote mounting</h2><p>Remote mounting is a possible future feature of TAS. It is not currently implemented.</p><p>With remote mounting, apps can produce APIs (SoT or non-SoT) by remote mounting a specified tenant&#39;s SoT production of the same API.</p><p>For example:</p><ul><li>tenant acme has installed a number of job board apps</li><li>the tenant wants each job board app to produce (non-SoT) the /categories API</li><li>so that acme&#39;s other apps can query each job board&#39;s unique category setup, build mappings, etc.</li><li>the job board "green jobs" provides such a job board app</li><li>that app produces (non-SoT) /categories</li><li>however it does so by remote mounting the same API at the central green jobs tenant</li><li>inside the green jobs tenant, the app "corestuff" produces (SoT) the /categories API</li><li>therefore corestuff finishes up producing the API when consumed by some other app at the acme tenant</li></ul><p>TAS detects and disallows loops.</p></div><div class="panel-group"><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_routes__CT_"><span class="parent">/routes</span>/{CT}</a> <span class="methods"></span></h4></div><div id="panel_routes__CT_" class="panel-collapse collapse"><div class="panel-body"><div class="resource-description"><p>Consuming tenant: the tenant with the app installed that is consuming the API</p></div><div class="list-group"></div></div></div></div><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_routes__CT___CA_"><span class="parent">/routes/{CT}</span>/{CA}</a> <span class="methods"><a href="#routes__CT___CA__get"><span class="badge badge_get">get</span></a></span></h4></div><div id="panel_routes__CT___CA_" class="panel-collapse collapse"><div class="panel-body"><div class="resource-description"><p>Consuming app: the app consuming the API</p></div><div class="list-group"><div onclick="window.location.href = '#routes__CT___CA__get'" class="list-group-item"><span class="badge badge_get">get</span><div class="method_description"><p>Used by tenant API consumers to fetch the route(s) from the consumer to each producer of a specific API.</p><p>The core checks that:</p><ul><li>the app making the core API call is the consuming app (i.e., matches {CA})</li><li>the consuming app is installed at {CT}</li><li>the consuming app has declared that it consumes the given API, in the given way (SoT or not).</li></ul></div><div class="clearfix"></div></div></div></div></div><div class="modal fade" tabindex="0" id="routes__CT___CA__get"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel"><span class="badge badge_get">get</span> <span class="parent">/routes/{CT}</span>/{CA}</h4></div><div class="modal-body"><div class="alert alert-info"><p>Used by tenant API consumers to fetch the route(s) from the consumer to each producer of a specific API.</p><p>The core checks that:</p><ul><li>the app making the core API call is the consuming app (i.e., matches {CA})</li><li>the consuming app is installed at {CT}</li><li>the consuming app has declared that it consumes the given API, in the given way (SoT or not).</li></ul></div><ul class="nav nav-tabs"><li class="active"><a href="#routes__CT___CA__get_request" data-toggle="tab">Request</a></li><li><a href="#routes__CT___CA__get_response" data-toggle="tab">Response</a></li></ul><div class="tab-content"><div class="tab-pane active" id="routes__CT___CA__get_request"><h3>URI Parameters</h3><ul><li><strong>CT</strong>: <em>required (string)</em></li><li><strong>CA</strong>: <em>required (string)</em></li></ul><h3>Query Parameters</h3><ul><li><strong>apiDev</strong>: <em>required (string)</em><p>Developer who defined the API</p><p><strong>Example</strong>:</p><pre>tas</pre></li><li><strong>api</strong>: <em>required (string)</em><p>API URI Template: the URI template (as per <a href="https://tools.ietf.org/html/rfc6570">https://tools.ietf.org/html/rfc6570</a>) of the API being consumed. The URI must be encoded as per <a href="http://www.w3.org/TR/html4/interact/forms.html#h-17.13.4">http://www.w3.org/TR/html4/interact/forms.html#h-17.13.4</a>, for example in Java using the URLEncoder class <a href="http://docs.oracle.com/javase/8/docs/api/java/net/URLEncoder.html">http://docs.oracle.com/javase/8/docs/api/java/net/URLEncoder.html</a>.</p><p>For example, if the API is /jobs/{job}, then you would pass %2fjobs%2f%7bjob%7d.</p><p><strong>Example</strong>:</p><pre>%2fjobs%2f%7bjob%7d
</pre></li><li><strong>sot</strong>: <em>required (boolean)</em><p>True if the consuming app is consuming this as SoT (source of truth), otherwise false</p><p><strong>Example</strong>:</p><pre><code>true</code></pre></li></ul></div><div class="tab-pane" id="routes__CT___CA__get_response"><h2>HTTP status code <a href="http://httpstatus.es/200" target="_blank">200</a></h2><h3>Body</h3><p><strong>Type: application/json</strong></p><p><strong>Schema</strong>:</p><pre><code>{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "type": "object",
    "properties": {
        "consumingAppInstall": {
            "$ref": "./routeBase.json#/definitions/installDetail"
        },
        "consumedApi": {
            "$ref": "./routeBase.json#/definitions/consumedApi"
        },
        "producingAppInstalls": {
            "type": "array",
            "items": {
                "$ref": "./routeBase.json#/definitions/installDetail"
            }
        }
    }
}</code></pre><p><strong>Example</strong>:</p><pre><code>{
    "consumingAppInstall": {
        "tenant": "acme",
        "app": "jobboardhub",
        "methods": [
            "GET",
            "POST"
        ],
        "securityGeneration": 1409
    },
    "consumedApi": {
        "apiDeveloper": "tas",
        "apiUriTemplate": "/categories",
        "consumedAsSourceOfTruth": false,
        "methods": [
            "GET",
            "POST",
            "DELETE"
        ]
    },
    "producingAppInstalls": [
        {
            "tenant": "seek",
            "app": "basecats",
            "endPoint": "https://ref.seek.com:2109/api/v3.2",
            "securityGeneration": 301
        },
        {
            "tenant": "greenjobsite",
            "app": "gjcore",
            "endPoint": "https://api.greenjobs.co.nz/v1",
            "securityGeneration": 80
        }
    ]
}
</code></pre></div></div></div></div></div></div></div><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_routes__CT___CA___PT_"><span class="parent">/routes/{CT}/{CA}</span>/{PT}</a> <span class="methods"></span></h4></div><div id="panel_routes__CT___CA___PT_" class="panel-collapse collapse"><div class="panel-body"><div class="resource-description"><p>Producing tenant: the tenant with the app installed that is producing the API</p></div><div class="list-group"></div></div></div></div><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_routes__CT___CA___PT___PA_"><span class="parent">/routes/{CT}/{CA}/{PT}</span>/{PA}</a> <span class="methods"><a href="#routes__CT___CA___PT___PA__get"><span class="badge badge_get">get</span></a></span></h4></div><div id="panel_routes__CT___CA___PT___PA_" class="panel-collapse collapse"><div class="panel-body"><div class="resource-description"><p>Producing app: the app producing the API</p></div><div class="list-group"><div onclick="window.location.href = '#routes__CT___CA___PT___PA__get'" class="list-group-item"><span class="badge badge_get">get</span><div class="method_description"><p>Used by tenant API producers to verify that the consumer is allowed to consume this API.</p><p>The core will assert that:</p><ul><li>the app making the core API call is the producing app (i.e., matches {PA})</li><li>the producing app is installed at {PT}</li><li>the consuming app is installed at {CT}</li><li>the consuming app has declared that it consumes the given API</li><li>the producing app has declared that it produces the given API</li><li>the consuming app has declared that it consumes the given API in the same way that the producer has declared that it produces it (SoT or not).</li></ul><p>Since both consuming and producing apps are specified, there can only be one or zero routes in the response.</p></div><div class="clearfix"></div></div></div></div></div><div class="modal fade" tabindex="0" id="routes__CT___CA___PT___PA__get"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel"><span class="badge badge_get">get</span> <span class="parent">/routes/{CT}/{CA}/{PT}</span>/{PA}</h4></div><div class="modal-body"><div class="alert alert-info"><p>Used by tenant API producers to verify that the consumer is allowed to consume this API.</p><p>The core will assert that:</p><ul><li>the app making the core API call is the producing app (i.e., matches {PA})</li><li>the producing app is installed at {PT}</li><li>the consuming app is installed at {CT}</li><li>the consuming app has declared that it consumes the given API</li><li>the producing app has declared that it produces the given API</li><li>the consuming app has declared that it consumes the given API in the same way that the producer has declared that it produces it (SoT or not).</li></ul><p>Since both consuming and producing apps are specified, there can only be one or zero routes in the response.</p></div><ul class="nav nav-tabs"><li class="active"><a href="#routes__CT___CA___PT___PA__get_request" data-toggle="tab">Request</a></li><li><a href="#routes__CT___CA___PT___PA__get_response" data-toggle="tab">Response</a></li></ul><div class="tab-content"><div class="tab-pane active" id="routes__CT___CA___PT___PA__get_request"><h3>URI Parameters</h3><ul><li><strong>CT</strong>: <em>required (string)</em></li><li><strong>CA</strong>: <em>required (string)</em></li><li><strong>PT</strong>: <em>required (string)</em></li><li><strong>PA</strong>: <em>required (string)</em></li></ul><h3>Query Parameters</h3><ul><li><strong>apiDev</strong>: <em>required (string)</em><p>Developer who defined the API</p><p><strong>Example</strong>:</p><pre>tas</pre></li><li><strong>api</strong>: <em>required (string)</em><p>API URI Template: the URI template (as per <a href="https://tools.ietf.org/html/rfc6570">https://tools.ietf.org/html/rfc6570</a>) of the API being consumed. The URI must be encoded as per <a href="http://www.w3.org/TR/html4/interact/forms.html#h-17.13.4">http://www.w3.org/TR/html4/interact/forms.html#h-17.13.4</a>, for example in Java using the URLEncoder class <a href="http://docs.oracle.com/javase/8/docs/api/java/net/URLEncoder.html">http://docs.oracle.com/javase/8/docs/api/java/net/URLEncoder.html</a>.</p><p>For example, if the API is /jobs/{job}, then you would pass %2fjobs%2f%7bjob%7d.</p><p><strong>Example</strong>:</p><pre>%2fjobs%2f%7bjob%7d
</pre></li></ul></div><div class="tab-pane" id="routes__CT___CA___PT___PA__get_response"><h2>HTTP status code <a href="http://httpstatus.es/200" target="_blank">200</a></h2><h3>Body</h3><p><strong>Type: application/json</strong></p><p><strong>Schema</strong>:</p><pre><code>{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "type": "object",
    "properties": {
        "consumingAppInstall": {
            "$ref": "./routeBase.json#/definitions/installDetail"
        },
        "consumedApi": {
            "$ref": "./routeBase.json#/definitions/consumedApi"
        },
        "producingAppInstall": {
            "$ref": "./routeBase.json#/definitions/installDetail"
        }
    }
}</code></pre><p><strong>Example</strong>:</p><pre><code>{
    "consumingAppInstall": {
        "tenant": "acme",
        "app": "jobboardhub",
        "methods": [
            "GET",
            "POST"
        ],
        "securityGeneration": 1409
    },
    "consumedApi": {
        "apiDeveloper": "tas",
        "apiUriTemplate": "/categories",
        "consumedAsSourceOfTruth": false,
        "methods": [
            "GET",
            "POST",
            "DELETE"
        ],
        "principalType": "candidate"
    },
    "producingAppInstall": {
        "tenant": "seek",
        "app": "basecats",
        "endPoint": "https://ref.seek.com:2109/api/v3.2",
        "securityGeneration": 301
    }
}</code></pre><h2>HTTP status code <a href="http://httpstatus.es/400" target="_blank">400</a></h2><p>returned on any failure of the assertions described above</p></div></div></div></div></div></div></div></div></div></div><div class="panel panel-default"><div class="panel-heading"><h3 id="samlIdPMetadata" class="panel-title">/samlIdPMetadata</h3></div><div class="panel-body"><div class="top-resource-description"><p>Apps that are SSO-protected (i.e., SPs in SAML lingo) require the SAML metadata for the TAS core proxy that acts as a facade in front of all of the identity providers that all of the tenants has set up. In other words there is a single unit of IdP metadata that can be used by all apps at all tenants.</p></div><div class="panel-group"><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_samlIdPMetadata"><span class="parent"></span>/samlIdPMetadata</a> <span class="methods"><a href="#samlIdPMetadata_get"><span class="badge badge_get">get</span></a></span></h4></div><div id="panel_samlIdPMetadata" class="panel-collapse collapse"><div class="panel-body"><div class="list-group"><div onclick="window.location.href = '#samlIdPMetadata_get'" class="list-group-item"><span class="badge badge_get">get</span><div class="method_description"><p>description: Get the metadata for the IdP proxy.</p><p>The core asserts that:</p><ul><li>the app is linked to any principal type (i.e., it uses SSO)</li></ul></div><div class="clearfix"></div></div></div></div></div><div class="modal fade" tabindex="0" id="samlIdPMetadata_get"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel"><span class="badge badge_get">get</span> <span class="parent"></span>/samlIdPMetadata</h4></div><div class="modal-body"><div class="alert alert-info"><p>description: Get the metadata for the IdP proxy.</p><p>The core asserts that:</p><ul><li>the app is linked to any principal type (i.e., it uses SSO)</li></ul></div><ul class="nav nav-tabs"><li><a href="#samlIdPMetadata_get_response" data-toggle="tab">Response</a></li></ul><div class="tab-content"><div class="tab-pane" id="samlIdPMetadata_get_response"><h2>HTTP status code <a href="http://httpstatus.es/200" target="_blank">200</a></h2><h3>Body</h3><p><strong>Type: application/xml</strong></p></div></div></div></div></div></div></div></div></div></div><div class="panel panel-default"><div class="panel-heading"><h3 id="tenants" class="panel-title">/tenants</h3></div><div class="panel-body"><div class="top-resource-description"><p>A <em>tenant</em> is a customer within the multi-tenanted environment of Talent App Store.</p></div><div class="panel-group"><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_tenants"><span class="parent"></span>/tenants</a> <span class="methods"><a href="#tenants_get"><span class="badge badge_get">get</span></a></span></h4></div><div id="panel_tenants" class="panel-collapse collapse"><div class="panel-body"><div class="list-group"><div onclick="window.location.href = '#tenants_get'" class="list-group-item"><span class="badge badge_get">get</span><div class="method_description"><p>Get a list of shortCodes of every tenant that has this app installed.</p></div><div class="clearfix"></div></div></div></div></div><div class="modal fade" tabindex="0" id="tenants_get"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel"><span class="badge badge_get">get</span> <span class="parent"></span>/tenants</h4></div><div class="modal-body"><div class="alert alert-info"><p>Get a list of shortCodes of every tenant that has this app installed.</p></div><ul class="nav nav-tabs"><li><a href="#tenants_get_response" data-toggle="tab">Response</a></li></ul><div class="tab-content"><div class="tab-pane" id="tenants_get_response"><h2>HTTP status code <a href="http://httpstatus.es/200" target="_blank">200</a></h2><h3>Body</h3><p><strong>Type: application/json</strong></p><p><strong>Schema</strong>:</p><pre><code>{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "definitions": {
        "tenant": {
            "type": "string",
            "description": "shortcode of a tenant"
        }
    },
    "type": "array",
    "items": {
        "$ref": "#/definitions/tenant"
    }
}</code></pre><p><strong>Example</strong>:</p><pre><code>[ "joesshoes", "acme", "asb" ]</code></pre></div></div></div></div></div></div></div><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_tenants__tenant_"><span class="parent">/tenants</span>/{tenant}</a> <span class="methods"><a href="#tenants__tenant__get"><span class="badge badge_get">get</span></a></span></h4></div><div id="panel_tenants__tenant_" class="panel-collapse collapse"><div class="panel-body"><div class="resource-description"><p>APIs concerned with a specific tenant. For all these APIs, the core asserts that:</p><ul><li>the calling app is installed at the tenant</li></ul></div><div class="list-group"><div onclick="window.location.href = '#tenants__tenant__get'" class="list-group-item"><span class="badge badge_get">get</span><div class="method_description"><p>Get details of the tenant.</p></div><div class="clearfix"></div></div></div></div></div><div class="modal fade" tabindex="0" id="tenants__tenant__get"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel"><span class="badge badge_get">get</span> <span class="parent">/tenants</span>/{tenant}</h4></div><div class="modal-body"><div class="alert alert-info"><p>Get details of the tenant.</p></div><ul class="nav nav-tabs"><li class="active"><a href="#tenants__tenant__get_request" data-toggle="tab">Request</a></li><li><a href="#tenants__tenant__get_response" data-toggle="tab">Response</a></li></ul><div class="tab-content"><div class="tab-pane active" id="tenants__tenant__get_request"><h3>URI Parameters</h3><ul><li><strong>tenant</strong>: <em>required (string)</em></li></ul></div><div class="tab-pane" id="tenants__tenant__get_response"><h2>HTTP status code <a href="http://httpstatus.es/200" target="_blank">200</a></h2><h3>Body</h3><p><strong>Type: application/json</strong></p><p><strong>Schema</strong>:</p><pre><code>{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "type": "object",
    "additionalProperties": false,
    "properties": {
        "name": {
            "type": "string",
            "description": "name of the tenant"
        },
        "shortCode": {
            "type": "string",
            "description": "a short, lower case identifier for the tenant, e.g. acme"
        },
        "type": {
            "enum": [
                "PRODUCTION",
                "SANDBOX"
            ],
            "description": "The type of tenant, i.e. sandbox or not. Apps behave differently when installed in a sandbox."
        },
        "logoUrl": {
            "type": "string",
            "description": "url for the tenant&#39;s logo"
        }
    },
    "required": ["name","shortCode","type"]
}</code></pre><p><strong>Example</strong>:</p><pre><code>{
 "shortCode": "acme-sandbox-1",
 "name": "Acme sandbox testing site",
 "type": "SANDBOX",
 "logoUrl": "https://s3-aws.com/786745987969"  
}
</code></pre></div></div></div></div></div></div></div><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_tenants__tenant__status"><span class="parent">/tenants/{tenant}</span>/status</a> <span class="methods"><a href="#tenants__tenant__status_get"><span class="badge badge_get">get</span></a></span></h4></div><div id="panel_tenants__tenant__status" class="panel-collapse collapse"><div class="panel-body"><div class="list-group"><div onclick="window.location.href = '#tenants__tenant__status_get'" class="list-group-item"><span class="badge badge_get">get</span><div class="method_description"><p>Get the status of the tenant, including the current state and security generation. Normally apps would use this information when restarting to determine whether to flush cached OAuth tokens and routes.</p></div><div class="clearfix"></div></div></div></div></div><div class="modal fade" tabindex="0" id="tenants__tenant__status_get"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel"><span class="badge badge_get">get</span> <span class="parent">/tenants/{tenant}</span>/status</h4></div><div class="modal-body"><div class="alert alert-info"><p>Get the status of the tenant, including the current state and security generation. Normally apps would use this information when restarting to determine whether to flush cached OAuth tokens and routes.</p></div><ul class="nav nav-tabs"><li class="active"><a href="#tenants__tenant__status_get_request" data-toggle="tab">Request</a></li><li><a href="#tenants__tenant__status_get_response" data-toggle="tab">Response</a></li></ul><div class="tab-content"><div class="tab-pane active" id="tenants__tenant__status_get_request"><h3>URI Parameters</h3><ul><li><strong>tenant</strong>: <em>required (string)</em></li></ul></div><div class="tab-pane" id="tenants__tenant__status_get_response"><h2>HTTP status code <a href="http://httpstatus.es/200" target="_blank">200</a></h2><h3>Body</h3><p><strong>Type: application/json</strong></p><p><strong>Schema</strong>:</p><pre><code>{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "type": "object",
    "additionalProperties": false,
    "properties": {
        "incarnation": {
            "type": "integer",
            "description": "a number representing the &#39;configuration version&#39; of this tenant. Incremented on any changes to the installed apps."
        },
        "securityGeneration": {
            "type": "integer",
            "description": "a number representing the &#39;security version&#39; of this tenant. Incremented when tenant signals such during a patch operation."
        },
        "state": {
            "enum": [
                "PREHALTING",
                "PREHALTED",
                "HALTING",
                "HALTED",
                "PRESTARTING",
                "PRESTARTED",
                "STARTING",
                "STARTED",
                "BROKEN"
            ],
            "description": "The tenant&#39;s current status."
        }
    },
    "required": [ "incarnation", "securityGeneration"]
}</code></pre><p><strong>Example</strong>:</p><pre><code>{
 "incarnation": 1046,
 "securityGeneration": 12,
 "state": "HALTING"
}

</code></pre></div></div></div></div></div></div></div><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_tenants__tenant__saml"><span class="parent">/tenants/{tenant}</span>/saml</a> <span class="methods"></span></h4></div><div id="panel_tenants__tenant__saml" class="panel-collapse collapse"><div class="panel-body"><div class="resource-description"><p>APIs that deal with a SAML assertion issued to this application.</p><p>TAS acts as a SAML proxy, and captures and stores assertions in an internal database, partitioned by principal type, prior to handing them off to the app (SP). Since apps are linked to a principal type the APIs don&#39;t need the pt passed in to them..</p><p>For these APIs, the core asserts that:</p><ul><li>the app is linked to a principal type</li><li>the assertion was issued to this application, as installed at this tenant</li></ul></div><div class="list-group"></div></div></div></div><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_tenants__tenant__saml_assertions__PT_"><span class="parent">/tenants/{tenant}/saml/assertions</span>/{PT}</a> <span class="methods"></span></h4></div><div id="panel_tenants__tenant__saml_assertions__PT_" class="panel-collapse collapse"><div class="panel-body"><div class="resource-description"><p>The principal type of the SAML assertion.</p></div><div class="list-group"></div></div></div></div><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_tenants__tenant__saml_assertions__PT___key_"><span class="parent">/tenants/{tenant}/saml/assertions/{PT}</span>/{key}</a> <span class="methods"><a href="#tenants__tenant__saml_assertions__PT___key__get"><span class="badge badge_get">get</span></a></span></h4></div><div id="panel_tenants__tenant__saml_assertions__PT___key_" class="panel-collapse collapse"><div class="panel-body"><div class="list-group"><div onclick="window.location.href = '#tenants__tenant__saml_assertions__PT___key__get'" class="list-group-item"><span class="badge badge_get">get</span><div class="method_description"><p>Fetch a SAML assertion via its database key.</p></div><div class="clearfix"></div></div></div></div></div><div class="modal fade" tabindex="0" id="tenants__tenant__saml_assertions__PT___key__get"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel"><span class="badge badge_get">get</span> <span class="parent">/tenants/{tenant}/saml/assertions/{PT}</span>/{key}</h4></div><div class="modal-body"><div class="alert alert-info"><p>Fetch a SAML assertion via its database key.</p></div><ul class="nav nav-tabs"><li class="active"><a href="#tenants__tenant__saml_assertions__PT___key__get_request" data-toggle="tab">Request</a></li><li><a href="#tenants__tenant__saml_assertions__PT___key__get_response" data-toggle="tab">Response</a></li></ul><div class="tab-content"><div class="tab-pane active" id="tenants__tenant__saml_assertions__PT___key__get_request"><h3>URI Parameters</h3><ul><li><strong>tenant</strong>: <em>required (string)</em></li><li><strong>PT</strong>: <em>required (string)</em></li><li><strong>key</strong>: <em>required (string)</em></li></ul></div><div class="tab-pane" id="tenants__tenant__saml_assertions__PT___key__get_response"><h2>HTTP status code <a href="http://httpstatus.es/200" target="_blank">200</a></h2><h3>Body</h3><p><strong>Type: application/xml</strong></p><h2>HTTP status code <a href="http://httpstatus.es/404" target="_blank">404</a></h2><p>when the SAML assertion was not found or has expired</p></div></div></div></div></div></div></div><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_tenants__tenant__saml_keyLookups__PT_"><span class="parent">/tenants/{tenant}/saml/keyLookups</span>/{PT}</a> <span class="methods"><a href="#tenants__tenant__saml_keyLookups__PT__post"><span class="badge badge_post">post</span></a></span></h4></div><div id="panel_tenants__tenant__saml_keyLookups__PT_" class="panel-collapse collapse"><div class="panel-body"><div class="resource-description"><p>the principal type the assertion is for</p></div><div class="list-group"><div onclick="window.location.href = '#tenants__tenant__saml_keyLookups__PT__post'" class="list-group-item"><span class="badge badge_post">post</span><div class="method_description"><p>Fetch the key of an incoming SAML assertion. Used by apps which include their own SAML SP layer (rather than sitting behind the proxy).</p><p>The request body contains the content of the assertion to search for.</p></div><div class="clearfix"></div></div></div></div></div><div class="modal fade" tabindex="0" id="tenants__tenant__saml_keyLookups__PT__post"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel"><span class="badge badge_post">post</span> <span class="parent">/tenants/{tenant}/saml/keyLookups</span>/{PT}</h4></div><div class="modal-body"><div class="alert alert-info"><p>Fetch the key of an incoming SAML assertion. Used by apps which include their own SAML SP layer (rather than sitting behind the proxy).</p><p>The request body contains the content of the assertion to search for.</p></div><ul class="nav nav-tabs"><li class="active"><a href="#tenants__tenant__saml_keyLookups__PT__post_request" data-toggle="tab">Request</a></li><li><a href="#tenants__tenant__saml_keyLookups__PT__post_response" data-toggle="tab">Response</a></li></ul><div class="tab-content"><div class="tab-pane active" id="tenants__tenant__saml_keyLookups__PT__post_request"><h3>URI Parameters</h3><ul><li><strong>tenant</strong>: <em>required (string)</em></li><li><strong>PT</strong>: <em>required (string)</em></li></ul><h3>Body</h3><p><strong>Type: application/xml</strong></p></div><div class="tab-pane" id="tenants__tenant__saml_keyLookups__PT__post_response"><h2>HTTP status code <a href="http://httpstatus.es/200" target="_blank">200</a></h2><h3>Body</h3><p><strong>Type: application/json</strong></p><p><strong>Schema</strong>:</p><pre><code>{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "type": "object",
    "description": "key of the SAML assertion with the the TAS core SAML database",
    "additionalProperties": false,
    "required": [
        "samlKey"
    ],
    "properties": {
        "samlKey": {
            "type": "string",
            "description": "key of the SAML assertion with the the TAS core SAML database"
        }
    }
}</code></pre><p><strong>Example</strong>:</p><pre><code>{
      "samlKey": "uyytg875GHui56Fe87JfgOL"
}</code></pre><h2>HTTP status code <a href="http://httpstatus.es/404" target="_blank">404</a></h2><p>when the SAML assertion was not found or has expired</p></div></div></div></div></div></div></div><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_tenants__tenant__samlSPMetadata"><span class="parent">/tenants/{tenant}</span>/samlSPMetadata</a> <span class="methods"><a href="#tenants__tenant__samlSPMetadata_get"><span class="badge badge_get">get</span></a></span></h4></div><div id="panel_tenants__tenant__samlSPMetadata" class="panel-collapse collapse"><div class="panel-body"><div class="resource-description"><p>Apps that are SSO-protected (i.e., SPs in SAML lingo) require their own SAML metadata</p></div><div class="list-group"><div onclick="window.location.href = '#tenants__tenant__samlSPMetadata_get'" class="list-group-item"><span class="badge badge_get">get</span><div class="method_description"><p>Get the metadata for this app (the SP) as installed at this tenant.</p><p>The core asserts that:</p><ul><li>the app is linked to any principal type (i.e., it uses SSO)</li></ul></div><div class="clearfix"></div></div></div></div></div><div class="modal fade" tabindex="0" id="tenants__tenant__samlSPMetadata_get"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel"><span class="badge badge_get">get</span> <span class="parent">/tenants/{tenant}</span>/samlSPMetadata</h4></div><div class="modal-body"><div class="alert alert-info"><p>Get the metadata for this app (the SP) as installed at this tenant.</p><p>The core asserts that:</p><ul><li>the app is linked to any principal type (i.e., it uses SSO)</li></ul></div><ul class="nav nav-tabs"><li class="active"><a href="#tenants__tenant__samlSPMetadata_get_request" data-toggle="tab">Request</a></li><li><a href="#tenants__tenant__samlSPMetadata_get_response" data-toggle="tab">Response</a></li></ul><div class="tab-content"><div class="tab-pane active" id="tenants__tenant__samlSPMetadata_get_request"><h3>URI Parameters</h3><ul><li><strong>tenant</strong>: <em>required (string)</em></li></ul></div><div class="tab-pane" id="tenants__tenant__samlSPMetadata_get_response"><h2>HTTP status code <a href="http://httpstatus.es/200" target="_blank">200</a></h2><h3>Body</h3><p><strong>Type: application/xml</strong></p></div></div></div></div></div></div></div><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_tenants__tenant__rebootPrepares"><span class="parent">/tenants/{tenant}</span>/rebootPrepares</a> <span class="methods"></span></h4></div><div id="panel_tenants__tenant__rebootPrepares" class="panel-collapse collapse"><div class="panel-body"><div class="resource-description"><p>A reboot is the process of TAS performing an orderly shutdown and startup of all of the installed apps for a specific tenant whenever major changes are made to the tenant.</p><p>The first step is to prepare the reboot using one of the rebootPrepares endpoints, which happens as a result of a tenant&#39;s actions in the storefront app&#39;s UI. Specifically;</p><ul><li>when a tenant clicks "install" or "uninstall" on an app, the storefront app calls POST /tenants/{tenant}/rebootPrepares/patchSet, resulting in a reboot with <a href="../examples/rebootStatus-juggleApps.json">events like these</a>.</li><li>when a tenant clicks "reboot" on their tenant, the storefront app calls POST /tenants/{tenant}/rebootPrepares/noop, resulting in a reboot with <a href="../examples/rebootStatus-simpleReboot.json">events like these</a>.</li><li>when a tenant clicks "flush OAuth tokens" on their tenant, the storefront app calls POST /tenants/{tenant}/rebootPrepares/OAuthFlush, resulting in a reboot with <a href="../examples/rebootStatus-bumpSecurityGeneration.json">events like these</a>.</li></ul><p>The response body from any of the /rebootPrepares endpoints is an unguessable unique "launch key" which is then used with POST /tenants/{tenant}/reboots/{launchKey}.</p><p>For all of these endpoints, the core asserts that:</p><ul><li>the app is marked as "storeFront".</li></ul></div><div class="list-group"></div></div></div></div><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_tenants__tenant__rebootPrepares_OAuthFlush"><span class="parent">/tenants/{tenant}/rebootPrepares</span>/OAuthFlush</a> <span class="methods"><a href="#tenants__tenant__rebootPrepares_OAuthFlush_post"><span class="badge badge_post">post</span></a></span></h4></div><div id="panel_tenants__tenant__rebootPrepares_OAuthFlush" class="panel-collapse collapse"><div class="panel-body"><div class="list-group"><div onclick="window.location.href = '#tenants__tenant__rebootPrepares_OAuthFlush_post'" class="list-group-item"><span class="badge badge_post">post</span><div class="method_description"><p>A storefront app calls this endpoint to prepare a reboot that will increment the tenant&#39;s security generation.</p><p>Called when a tenant admin person clicks "Flush tokens" in the storefront.</p><p>This effectively invalidates all OAuth tokens for APIs consumed or produced by this tenant (since apps should always check for changed security generation). This is used by a tenant to mitigate an attack where the attacker has obtained an OAuth token.</p></div><div class="clearfix"></div></div></div></div></div><div class="modal fade" tabindex="0" id="tenants__tenant__rebootPrepares_OAuthFlush_post"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel"><span class="badge badge_post">post</span> <span class="parent">/tenants/{tenant}/rebootPrepares</span>/OAuthFlush</h4></div><div class="modal-body"><div class="alert alert-info"><p>A storefront app calls this endpoint to prepare a reboot that will increment the tenant&#39;s security generation.</p><p>Called when a tenant admin person clicks "Flush tokens" in the storefront.</p><p>This effectively invalidates all OAuth tokens for APIs consumed or produced by this tenant (since apps should always check for changed security generation). This is used by a tenant to mitigate an attack where the attacker has obtained an OAuth token.</p></div><ul class="nav nav-tabs"><li class="active"><a href="#tenants__tenant__rebootPrepares_OAuthFlush_post_request" data-toggle="tab">Request</a></li><li><a href="#tenants__tenant__rebootPrepares_OAuthFlush_post_response" data-toggle="tab">Response</a></li></ul><div class="tab-content"><div class="tab-pane active" id="tenants__tenant__rebootPrepares_OAuthFlush_post_request"><h3>URI Parameters</h3><ul><li><strong>tenant</strong>: <em>required (string)</em></li></ul></div><div class="tab-pane" id="tenants__tenant__rebootPrepares_OAuthFlush_post_response"><h2>HTTP status code <a href="http://httpstatus.es/200" target="_blank">200</a></h2><h3>Body</h3><p><strong>Type: application/json</strong></p><p><strong>Schema</strong>:</p><pre><code>{
	"$schema":"http://json-schema.org/draft-04/schema#",
	"type":"object",
	"additionalProperties":false,
	"properties":{
		"launchKey": { "type": "integer", "description": "an unguessable key used to get information about a previously launched patchSet"}
	},
	"required":[
		"launchKey"
	]
}
</code></pre><p><strong>Example</strong>:</p><pre><code>{
	"launchKey": 40864894563934
}</code></pre></div></div></div></div></div></div></div><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_tenants__tenant__rebootPrepares_patchSet"><span class="parent">/tenants/{tenant}/rebootPrepares</span>/patchSet</a> <span class="methods"><a href="#tenants__tenant__rebootPrepares_patchSet_post"><span class="badge badge_post">post</span></a></span></h4></div><div id="panel_tenants__tenant__rebootPrepares_patchSet" class="panel-collapse collapse"><div class="panel-body"><div class="list-group"><div onclick="window.location.href = '#tenants__tenant__rebootPrepares_patchSet_post'" class="list-group-item"><span class="badge badge_post">post</span><div class="method_description"><p>A storefront app calls this endpoint to prepare a reboot that will change the installed apps, e.g. to reflect the tenant clicking install on an app. The endpoint validates the attached patch document.</p><p>Called when a tenant admin person clicks to install or uninstall apps in the storefront.</p></div><div class="clearfix"></div></div></div></div></div><div class="modal fade" tabindex="0" id="tenants__tenant__rebootPrepares_patchSet_post"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel"><span class="badge badge_post">post</span> <span class="parent">/tenants/{tenant}/rebootPrepares</span>/patchSet</h4></div><div class="modal-body"><div class="alert alert-info"><p>A storefront app calls this endpoint to prepare a reboot that will change the installed apps, e.g. to reflect the tenant clicking install on an app. The endpoint validates the attached patch document.</p><p>Called when a tenant admin person clicks to install or uninstall apps in the storefront.</p></div><ul class="nav nav-tabs"><li class="active"><a href="#tenants__tenant__rebootPrepares_patchSet_post_request" data-toggle="tab">Request</a></li><li><a href="#tenants__tenant__rebootPrepares_patchSet_post_response" data-toggle="tab">Response</a></li></ul><div class="tab-content"><div class="tab-pane active" id="tenants__tenant__rebootPrepares_patchSet_post_request"><h3>URI Parameters</h3><ul><li><strong>tenant</strong>: <em>required (string)</em></li></ul><h3>Body</h3><p><strong>Type: application/json</strong></p><p><strong>Schema</strong>:</p><pre><code>{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "definitions": {
        "app": {
            "type": "string",
            "description": "the shortCode of an app"
        },
        "appList": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/app"
            }
        }
    },
    "additionalProperties": false,
    "properties": {
        "installs": {
            "description": "apps to be installed",
            "$ref": "#/definitions/appList"
        },
        "unInstalls": {
            "description": "apps to be uninstalled",
            "$ref": "#/definitions/appList"
        }
    }
}</code></pre><p><strong>Example</strong>:</p><pre><code>{
   "installs": [ "oldjobboard" ],
   "unInstalls": [ "newjobboard" ]
}</code></pre></div><div class="tab-pane" id="tenants__tenant__rebootPrepares_patchSet_post_response"><h2>HTTP status code <a href="http://httpstatus.es/200" target="_blank">200</a></h2><h3>Body</h3><p><strong>Type: application/json</strong></p><p><strong>Schema</strong>:</p><pre><code>{
	"$schema":"http://json-schema.org/draft-04/schema#",
	"type":"object",
	"additionalProperties":false,
	"properties":{
		"launchKey": { "type": "integer", "description": "an unguessable key used to get information about a previously launched patchSet"}
	},
	"required":[
		"launchKey"
	]
}
</code></pre><p><strong>Example</strong>:</p><pre><code>{
	"launchKey": 40864894563934
}</code></pre></div></div></div></div></div></div></div><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_tenants__tenant__rebootPrepares_noop"><span class="parent">/tenants/{tenant}/rebootPrepares</span>/noop</a> <span class="methods"><a href="#tenants__tenant__rebootPrepares_noop_post"><span class="badge badge_post">post</span></a></span></h4></div><div id="panel_tenants__tenant__rebootPrepares_noop" class="panel-collapse collapse"><div class="panel-body"><div class="list-group"><div onclick="window.location.href = '#tenants__tenant__rebootPrepares_noop_post'" class="list-group-item"><span class="badge badge_post">post</span><div class="method_description"><p>A storefront app calls this endpoint to prepare a reboot that does nothing else.</p><p>This provides a way to retry on failures that have locked up the tenant, e.g. a bad response from one of the orchestration APIs.</p><p>Called when tenant admin person clicks "Reboot" in the storefront.</p></div><div class="clearfix"></div></div></div></div></div><div class="modal fade" tabindex="0" id="tenants__tenant__rebootPrepares_noop_post"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel"><span class="badge badge_post">post</span> <span class="parent">/tenants/{tenant}/rebootPrepares</span>/noop</h4></div><div class="modal-body"><div class="alert alert-info"><p>A storefront app calls this endpoint to prepare a reboot that does nothing else.</p><p>This provides a way to retry on failures that have locked up the tenant, e.g. a bad response from one of the orchestration APIs.</p><p>Called when tenant admin person clicks "Reboot" in the storefront.</p></div><ul class="nav nav-tabs"><li class="active"><a href="#tenants__tenant__rebootPrepares_noop_post_request" data-toggle="tab">Request</a></li><li><a href="#tenants__tenant__rebootPrepares_noop_post_response" data-toggle="tab">Response</a></li></ul><div class="tab-content"><div class="tab-pane active" id="tenants__tenant__rebootPrepares_noop_post_request"><h3>URI Parameters</h3><ul><li><strong>tenant</strong>: <em>required (string)</em></li></ul></div><div class="tab-pane" id="tenants__tenant__rebootPrepares_noop_post_response"><h2>HTTP status code <a href="http://httpstatus.es/200" target="_blank">200</a></h2><h3>Body</h3><p><strong>Type: application/json</strong></p><p><strong>Schema</strong>:</p><pre><code>{
	"$schema":"http://json-schema.org/draft-04/schema#",
	"type":"object",
	"additionalProperties":false,
	"properties":{
		"launchKey": { "type": "integer", "description": "an unguessable key used to get information about a previously launched patchSet"}
	},
	"required":[
		"launchKey"
	]
}
</code></pre><p><strong>Example</strong>:</p><pre><code>{
	"launchKey": 40864894563934
}</code></pre></div></div></div></div></div></div></div><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_tenants__tenant__reboots"><span class="parent">/tenants/{tenant}</span>/reboots</a> <span class="methods"></span></h4></div><div id="panel_tenants__tenant__reboots" class="panel-collapse collapse"><div class="panel-body"><div class="resource-description"><h2 id="about-reboots">About reboots</h2><p>A reboot is the process of TAS performing an orderly shutdown and startup of all of the installed apps for a specific tenant whenever major changes are made to the tenant.</p><p>To play its part correctly when a reboot happens, your app&#39;s control server should produce the reboot APIs. TAS then consumes the following APIs during the reboot.</p><ul><li>/tenants/{}/preHalts</li><li>/tenants/{}/halts</li><li>/tenants/{}/preStarts</li><li>/tenants/{}/starts</li></ul><p>As a reboot happens, TAS maintains a set of history events that the storefront app can use to feed a progress dialogue.</p><h2 id="how-the-storefront-launches-a-reboot">How the storefront launches a reboot</h2><p>Once the storefront app has prepared a reboot by calling one of the POST /tenants/{tenant}/rebootPrepares endpoints, the the reboot does not start immediately. Instead, the APIs return a launch key.</p><p>To actually start a reboot, the storefront app (typically from within a web page&#39;s onClick handler of a "Continue" button) uses this launch key to launch the reboot.</p><p>As a reboot happens, TAS maintains the event history, and also a status for;</p><ul><li>the tenant as a whole (see <a href="../schemas/tenantStatus.json">tenant statuses</a>)</li><li>each individual app</li></ul><h2 id="order-of-events-during-reboot">Order of events during reboot</h2><p>During a reboot, the order of events is:</p><ul><li><p>Halt all apps</p><ul><li>TAS sets the tenant&#39;s status to "preHalting"</li><li>TAS calls /tenants/{}/preHalts on each installed app</li><li>When the last app returns 200, TAS sets the tenant&#39;s status to "preHalted"</li><li>TAS sets the tenant&#39;s status to "halting"</li><li>TAS calls /tenants/{}/halts on each installed app</li><li>When the last app returns 200, TAS sets the tenant&#39;s status to "halted"</li></ul></li><li><p>TAS increments tenant.incarnation</p></li><li>TAS performs the actual operation, i.e.:<ul><li>do nothing (if this reboot is in response to a call to POST /tenants/{}/reboots)</li><li>apply the patch set, e.g. to install an app (if this reboot is in response to a call to POST /tenants/{}/patchSets)<ul><li>apps are installed or uninstalled</li><li>routes are adjusted</li></ul></li><li>increment tenant.securityGeneration<ul><li>explicitly (if this reboot is in response to a call to POST /tenants/{}/OAuthFlushes, i.e. the tenant clicked "Flush OAuth tokens"); or</li><li>implicitly (if this reboot is in response to a call to POST /tenants/{}/patchSets and TAS finds that the patch set is making changes to the tenant&#39;s idps or assertion hooks)</li></ul></li></ul></li><li>Start all apps<ul><li>TAS sets the tenant&#39;s status to "preStarting"</li><li>TAS calls /tenants/{}/preStarts on each installed app</li><li>When the last app returns 200, TAS sets the tenant&#39;s status to "preStarted"</li><li>TAS sets the tenant&#39;s status to "starting"</li><li>TAS calls /tenants/{}/starts on each installed app</li><li>When the last app returns 200, TAS sets the tenant&#39;s status to "starting"</li></ul></li></ul></div><div class="list-group"></div></div></div></div><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_tenants__tenant__reboots__launchKey_"><span class="parent">/tenants/{tenant}/reboots</span>/{launchKey}</a> <span class="methods"><a href="#tenants__tenant__reboots__launchKey__post"><span class="badge badge_post">post</span></a></span></h4></div><div id="panel_tenants__tenant__reboots__launchKey_" class="panel-collapse collapse"><div class="panel-body"><div class="list-group"><div onclick="window.location.href = '#tenants__tenant__reboots__launchKey__post'" class="list-group-item"><span class="badge badge_post">post</span><div class="method_description"><p>A storefront app&#39;s web page uses this API to launch a previously prepared reboot (if not already launched), and get the latest events and the current summary details.</p><p>This endpoint is unauthenticated and has CORS headers that allow access from any domain (since the javascript calling it belongs to a storefront app which does not share the same domain as the tas core).</p><p>If the apply is already "complete" then this call will return immediately, with any events that match the filter, up to the maximum events per call (100).</p><p>Otherwise, the call blocks for .5 seconds to avoid thrashing, then returns as soon as at least one event is available that matches the filter, or the apply becomes complete (which would always be accompanied by an event). If no events are available after 60 seconds, the call returns indicating a timeout - the client will typically immediately make another call in a typical long-polling pattern, until the apply is marked as complete and the last event has been fetched.</p><p>The core asserts:</p><ul><li>that no reboot is currently underway for the tenant</li></ul></div><div class="clearfix"></div></div></div></div></div><div class="modal fade" tabindex="0" id="tenants__tenant__reboots__launchKey__post"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel"><span class="badge badge_post">post</span> <span class="parent">/tenants/{tenant}/reboots</span>/{launchKey}</h4></div><div class="modal-body"><div class="alert alert-info"><p>A storefront app&#39;s web page uses this API to launch a previously prepared reboot (if not already launched), and get the latest events and the current summary details.</p><p>This endpoint is unauthenticated and has CORS headers that allow access from any domain (since the javascript calling it belongs to a storefront app which does not share the same domain as the tas core).</p><p>If the apply is already "complete" then this call will return immediately, with any events that match the filter, up to the maximum events per call (100).</p><p>Otherwise, the call blocks for .5 seconds to avoid thrashing, then returns as soon as at least one event is available that matches the filter, or the apply becomes complete (which would always be accompanied by an event). If no events are available after 60 seconds, the call returns indicating a timeout - the client will typically immediately make another call in a typical long-polling pattern, until the apply is marked as complete and the last event has been fetched.</p><p>The core asserts:</p><ul><li>that no reboot is currently underway for the tenant</li></ul></div><ul class="nav nav-tabs"><li class="active"><a href="#tenants__tenant__reboots__launchKey__post_request" data-toggle="tab">Request</a></li><li><a href="#tenants__tenant__reboots__launchKey__post_response" data-toggle="tab">Response</a></li></ul><div class="tab-content"><div class="tab-pane active" id="tenants__tenant__reboots__launchKey__post_request"><h3>URI Parameters</h3><ul><li><strong>tenant</strong>: <em>required (string)</em></li><li><strong>launchKey</strong>: <em>required (string)</em></li></ul><h3>Query Parameters</h3><ul><li><strong>afterEvent</strong>: <em>(integer)</em><p>The sequence of an existing event - this call should return events immediately <em>after</em> this event. Omitting this parameter returns the first events.</p><p><strong>Example</strong>:</p><pre><code>12</code></pre></li></ul></div><div class="tab-pane" id="tenants__tenant__reboots__launchKey__post_response"><h2>HTTP status code <a href="http://httpstatus.es/200" target="_blank">200</a></h2><h3>Body</h3><p><strong>Type: application/json</strong></p><p><strong>Schema</strong>:</p><pre><code>{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "definitions": {
        "app": {
            "type": "string"
        },
        "elapsedTime": {
            "description": "elapsed time of the operation in milliseconds",
            "type": "integer"
        },
        "tenantEvent": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "kind"
            ],
            "properties": {
                "kind": {
                    "enum": [
                        "patchSetApplyRebootStart",
                        "bumpSecurityGenerationRebootStart",
                        "simpleRebootStart",
                        "tenantPreHaltStart",
                        "tenantPreHaltComplete",
                        "tenantHaltStart",
                        "tenantHaltComplete",
                        "appPatchesApplyStart",
                        "appPatchesApplyComplete",
                        "bumpSecurityGenerationComplete",
                        "tenantPreStartStart",
                        "tenantPreStartComplete",
                        "tenantStartStart",
                        "tenantStartComplete",
                        "patchSetApplyRebootComplete",
                        "bumpSecurityGenerationRebootComplete",
                        "simpleRebootComplete"
                    ]
                }
            }
        },
        "appEvent": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "kind",
                "app"
            ],
            "properties": {
                "kind": {
                    "enum": [
                        "appPreHaltStart",
                        "appPreHaltComplete",
                        "appHaltStart",
                        "appHaltComplete",
                        "appPreStartStart",
                        "appPreStartComplete",
                        "appStartStart",
                        "appStartComplete",
                        "appInstallComplete",
                        "appUninstallComplete",
                        "appEditComplete"
                    ]
                },
                "app": {
                    "$ref": "#/definitions/app"
                }
            }
        },
        "tenantStatusEvent": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "kind",
                "incarnation",
                "securityGeneration"
            ],
            "properties": {
                "kind": {
                    "enum": [
                        "tenantStatusEvent"
                    ]
                },
                "incarnation": {
                    "type": "integer"
                },
                "securityGeneration": {
                    "type": "integer"
                }
            }
        },
        "orderedEvent": {
            "type": "object",
            "properties": {
                "seq": {
                    "type": "integer"
                },
                "time": {
                    "type": "string",
                    "format": "date-time"
                },
                "event": {
                    "oneOf": [
                        {
                            "$ref": "#/definitions/tenantEvent"
                        },
                        {
                            "$ref": "#/definitions/appEvent"
                        },
                        {
                            "$ref": "#/definitions/tenantStatusEvent"
                        }
                    ]
                }
            },
            "required": [
                "seq",
                "time",
                "event"
            ],
            "additionalProperties": false
        }
    },
    "type": "object",
    "additionalProperties": false,
    "required": [
        "status"
    ],
    "properties": {
        "status": {
            "enum": [
                "notLaunched",
                "inProcess",
                "complete"
            ]
        },
        "latestEvent": {
            "type": "integer"
        },
        "continuePage": {
            "type": "string",
            "description": "the URI that the browser should redirect the user to once this reboot is complete, possibly at a new storefront if a patch set apply swapped out the current one"
        },
        "events": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/orderedEvent"
            }
        }
    }
}</code></pre><p><strong>Example</strong>:</p><pre><code>{
  "status": "complete",
  "latestEvent": 52,
  "events": [
    {"seq": 0, "time": "2015-11-05T13:15:30Z", "event": {"kind": "patchSetApplyRebootStart"}},
    {"seq": 1, "time": "2015-11-05T13:15:30Z", "event": {"kind": "tenantPreHaltStart"}},
    {"seq": 2, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appPreHaltStart", "app": "tas-zoom"}},
    {"seq": 3, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appPreHaltStart", "app": "hrlabs-fratly"}},
    {"seq": 4, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appPreHaltComplete", "app": "tas-zoom"}},
    {"seq": 5, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appPreHaltStart", "app": "tas-dummyjobs"}},
    {"seq": 6, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appPreHaltStart", "app": "tas-uberapply"}},
    {"seq": 7, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appPreHaltComplete", "app": "hrlabs-fratly"}},
    {"seq": 8, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appPreHaltComplete", "app": "tas-dummyjobs"}},
    {"seq": 9, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appPreHaltComplete", "app": "tas-uberapply"}},
    {"seq": 10, "time": "2015-11-05T13:15:30Z", "event": {"kind": "tenantPreHaltComplete"}},
    {"seq": 11, "time": "2015-11-05T13:15:30Z", "event": {"kind": "tenantHaltStart"}},
    {"seq": 12, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appHaltStart", "app": "tas-zoom"}},
    {"seq": 13, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appHaltStart", "app": "hrlabs-fratly"}},
    {"seq": 14, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appHaltComplete", "app": "tas-zoom"}},
    {"seq": 15, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appHaltStart", "app": "tas-dummyjobs"}},
    {"seq": 16, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appHaltStart", "app": "tas-uberapply"}},
    {"seq": 17, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appHaltComplete", "app": "hrlabs-fratly"}},
    {"seq": 18, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appHaltComplete", "app": "tas-dummyjobs"}},
    {"seq": 19, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appHaltComplete", "app": "tas-uberapply"}},
    {"seq": 20, "time": "2015-11-05T13:15:30Z", "event": {"kind": "tenantHaltComplete"}},
    {"seq": 21, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appPatchesApplyStart"}},
    {"seq": 22, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appInstallComplete", "app": "tas-tracker"}},
    {"seq": 23, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appInstallComplete", "app": "supersoft-refly"}},
    {"seq": 24, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appEditComplete", "app": "tas-zoom"}},
    {"seq": 25, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appUninstallComplete", "app": "tas-dummyjobs"}},
    {"seq": 26, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appPatchesApplyComplete"}},
    {"seq": 27, "time": "2015-11-05T13:15:30Z", "event": {"kind": "tenantPreStartStart"}},
    {"seq": 28, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appPreStartStart", "app": "tas-zoom"}},
    {"seq": 29, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appPreStartStart", "app": "hrlabs-fratly"}},
    {"seq": 30, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appPreStartComplete", "app": "tas-zoom"}},
    {"seq": 31, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appPreStartComplete", "app": "hrlabs-fratly"}},
    {"seq": 32, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appPreStartStart", "app": "tas-uberapply"}},
    {"seq": 33, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appPreStartStart", "app": "tas-tracker"}},
    {"seq": 34, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appPreStartComplete", "app": "tas-tracker"}},
    {"seq": 35, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appPreStartStart", "app": "supersoft-refly"}},
    {"seq": 36, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appPreStartComplete", "app": "tas-uberapply"}},
    {"seq": 37, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appPreStartComplete", "app": "supersoft-refly"}},
    {"seq": 38, "time": "2015-11-05T13:15:30Z", "event": {"kind": "tenantPreStartComplete"}},
    {"seq": 39, "time": "2015-11-05T13:15:30Z", "event": {"kind": "tenantStartStart"}},
    {"seq": 40, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appStartStart", "app": "tas-zoom"}},
    {"seq": 41, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appStartStart", "app": "hrlabs-fratly"}},
    {"seq": 42, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appStartStart", "app": "tas-uberapply"}},
    {"seq": 43, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appStartStart", "app": "tas-tracker"}},
    {"seq": 44, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appStartStart", "app": "supersoft-refly"}},
    {"seq": 45, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appStartComplete", "app": "tas-zoom"}},
    {"seq": 46, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appStartComplete", "app": "hrlabs-fratly"}},
    {"seq": 47, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appStartComplete", "app": "tas-uberapply"}},
    {"seq": 48, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appStartComplete", "app": "tas-tracker"}},
    {"seq": 49, "time": "2015-11-05T13:15:30Z", "event": {"kind": "appStartComplete", "app": "supersoft-refly"}},
    {"seq": 50, "time": "2015-11-05T13:15:30Z", "event": {"kind": "tenantStartComplete"}},
    {"seq": 51, "time": "2015-11-05T13:15:30Z", "event": {"kind": "patchSetApplyRebootComplete"}},
    {"seq": 52, "time": "2015-11-05T13:15:30Z", "event": {"kind": "tenantStatusEvent", "incarnation": 146, "securityGeneration": 10 }}
  ]
}
</code></pre></div></div></div></div></div></div></div></div></div></div><div class="panel panel-default"><div class="panel-heading"><h3 id="token" class="panel-title">/token</h3></div><div class="panel-body"><div class="top-resource-description"><h2 id="about-oauth-tokens">About OAuth tokens</h2><p>API calls between apps (i.e. tenant API calls) are protected by OAuth access tokens, with TAS acting as the authorization server.</p><p>An OAuth token in TAS has <a href="../schemas/tokenJwt.json">this structure</a>. An example token is <a href="../examples/tokenJwt-simple.json">shown here</a>.</p><p>A single OAuth token is scoped by the combination of consumer, producer, API and SoT, and can be used to consume any allowable method on the API. Currently, the consumer and producer will always be at the same tenant.</p><p>The flow for consuming a tenant API is as follows;</p><ul><li>The app consuming the API (the consumer) calls GET /routes to locate the actual endpoint (the producer)</li><li>The consumer checks its cache to see if it already has an OAuth token for the combination of consumer and producer and API and SoT</li><li>If not, it calls POST /token to obtain an OAuth token from the TAS core</li><li>The consumer makes the API call, passing the token in the Authorization header</li><li>The producer checks that the token is valid and being used correctly</li><li>For on-behalf tokens, the producer extracts the logs in user&#39;s identity</li><li>The producer produces the API</li></ul><p>Rather than being passed as raw json, OAuth tokens are passed as a JWT (json web token; see <a href="http://jwt.io/">http://jwt.io/</a>). Because JWTs are self-contained and signed, producers can rely on their content without any network traffic to the authorization server (i.e. TAS core).</p><p>For more background on OAuth and tokens, see the [OAuth 2 spec(<a href="http://tools.ietf.org/html/rfc6749">http://tools.ietf.org/html/rfc6749</a>&#39;) and also Google&#39;s <a href="https://developers.google.com/accounts/docs/OAuth2WebServer">OAuth documentation</a> for additional context.</p><h2 id="on-behalf-tokens">On-behalf tokens</h2><p>OAuth tokens may further be on-behalf, i.e. principal-aware, in which case they also identify some ultimate logged in end user who the API call is on behalf of, in the "sub" field.</p><h2 id="refresh-tokens">Refresh tokens</h2><p>Some apps need to continue making API calls on behalf of a user, even when the user is no longer logged in.</p><p>Any app that is protected via TAS SSO and is marked as "offlineCapable" (TODO: exact name) can use the urn:ietf:params:oauth:client-assertion-type:saml2-bearer grant type (which requires a SAML assertion), and add " offline" to the scope parameter in the call to POST /token to create both an on-behalf OAuth access token and an accompanying refresh token. Your app should store the refresh token in its own long-term storage, and can use the access token immediately.</p><p>The access token can be used immediately, and when it expires, the refresh token can be used to generate new access tokens even when the user is no longer logged in.</p><p>Note: you only need to use refresh tokens if the offline activity is on behalf of a specific user. Otherwise your app can just use the client_credentials grant type to request a new OAuth token as soon as the existing one expires.</p><p>Example:</p><pre><code>POST /oauth2/v1/token HTTP/1.1
Host: core.talentappstore.com
Content-Type: application/x-www-form-urlencoded

grant_type=urn%3Aietf%3Aparams%3Aoauth%3Agrant-type%3Asaml2-bearer
scope=acme+jobboard+acme+ats+%2fjobs%2f%7bjob%7d+true+offline
principal_type=candidate
assertion=kjh9786gJHGutvfUT765Kkjghf70978klhjhgIUYGkpoiygEciYnjOi...
Response:
{
  "access_token":"iuhy76YT785L0GDF23JH7kjhd",
  "expires_in":3600,
  "token_type":"Bearer",
  "refresh_token":"j089777bhkltyHTRFG78969KJH968d"
}
</code></pre><p>Internally, TAS stores a copy of refresh tokens that it has issued, so it can validate requests for new access tokens. These refresh tokens are stored keyed by:</p><ul><li>principal type</li><li>saml key (i.e. a key for the specific SAML assertion that was passed in the "assertion" parameter user identifier (/E/N)</li><li>the SSO-protected app the user logged into (the API consuming app in this case)</li><li>consuming app install</li><li>producing app install</li></ul><p>Your app should save refresh tokens in long-term storage and continue to use them as long as they remain valid. If your app requests another refresh token for the same combination of values above, a new refresh token will be issued and any previous refresh token will be revoked.</p><p>There is currently no support for refresh token revocation as per <a href="https://tools.ietf.org/html/rfc7009">https://tools.ietf.org/html/rfc7009</a>.</p><h2 id="verifying-incoming-oauth-tokens">Verifying incoming OAuth tokens</h2><p>To be secure, when an app receives an incoming tenant API call, it must:</p><ul><li>Check that an incoming OAuth token was provided in the Authorization request header</li><li>Verify that the OAuth token was correctly signed by TAS core, and matches the public key from GET /OAuthKey.</li><li>Check that the token has not expired (exp field)</li><li>Check that it is the correct audience (to prevent a malicious app using a token for your app which was intended for another app), i.e.;<ul><li>the "pt" (producing tenant) field matches the current tenant (e.g. as extracted from the Host header)</li><li>the "pa" (producing app) field matches the shortCode hard-coded into the app&#39;s code</li></ul></li><li>Check, using "dev" and "api" fields, that the token is for this API (to prevent a malicious app calling an API on your app which it has not declared that it calls)</li><li>call GET /routes/{CT}/{CA}/{PT}/{PA} and verify that:<ul><li>the API is being consumed (as per "sot" in the token) in a way (SoT or not) that the consumer has declared</li><li>whatever method is being used (GET, POST, etc.) is one of the subset of supported methods that the consumer declares that it consumes as Sot or not as appropriate (to prevent a malicious app declaring that it only uses GET but then performing a DELETE).</li></ul></li></ul><p>Because performing the checks above involves making TAS core API calls, the producing app should attempt to cache the results whenever possible.</p><p>For intra-tenant calls (i.e., where the producer and the consumer are the same), the producer can cache verifications as long as the "sgen" (security generation) parameter in the token matches the app&#39;s own stored value for sgen.</p><p>This works because sgen cannot be changed without bouncing the tenant, and every app is always informed when the tenant is bounced, so the producer always knows it has the latest value for sgen.</p><p>A typical cache implementation might:</p><ul><li>store verification outcomes for intra-tenant calls as booleans in a key value store</li><li>key the outcomes by some synthesised string like /routes/acme/uberapply/acme/ats/tas/%2Fcategories/GET</li><li>flush the cache whenever sgen changes</li></ul><p>For inter-tenant calls (i.e. where the consumer is a remote app likely installed at another tenant), the producer does not receive any notifications when the remote tenant is bounced. Therefore it has no way to maintain an up to date copy of the remote tenant&#39;s sgen value. This means that the producer must verify the route every time. This is not an issue until when/if TAS supports remote mounting.</p></div><div class="panel-group"><div class="panel panel-white"><div class="panel-heading"><h4 class="panel-title"><a class="collapsed" data-toggle="collapse" href="#panel_token"><span class="parent"></span>/token</a> <span class="methods"><a href="#token_post"><span class="badge badge_post">post</span></a></span></h4></div><div id="panel_token" class="panel-collapse collapse"><div class="panel-body"><div class="list-group"><div onclick="window.location.href = '#token_post'" class="list-group-item"><span class="badge badge_post">post</span><div class="method_description"><p>Get a new access token, and optionally a refresh token.</p><p>The request body must be of content-type application/x-www-form-urlencoded, and contain values for grant_type and optionally other parameters, encoded as per <a href="https://tools.ietf.org/html/rfc6749#appendix-B">https://tools.ietf.org/html/rfc6749#appendix-B</a>. See also <a href="https://tools.ietf.org/html/rfc7522#section-4">https://tools.ietf.org/html/rfc7522#section-4</a>.</p><p>The core asserts that:</p><ul><li>the consuming app is installed at the consuming tenant</li><li>the producing app is installed at the producing tenant</li><li>there exists a route between the consumer and producer, for this API, consumed as SoT or not as relevant (this prevents malicious apps probing for the presence of other apps)</li><li>when a SAML assertion is passed directly or by key, that the assertion was issued to this application and not any other</li><li>if the API is on-behalf (is linked to a principal type) that one of the following grant types is being used:<ul><li>urn:ietf:params:oauth:client-assertion-type:saml2-bearer</li><li>urn:talentappstore.com:oauth:saml2-bearer-key</li><li>urn:talentappstore.com:oauth:tas-inherited</li><li>refresh_token</li></ul></li><li>if the API is not on-behalf (is linked to a principal type) that one of the following grant types is being used:<ul><li>client_credentials</li></ul></li></ul><p>Every call to this endpoint results in a new access token being issued, with an expiry time set to one hour, or (as per <a href="http://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRoleWithSAML.html">http://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRoleWithSAML.html</a>) to the time specified in the SAML assertion&#39;s SessionNotOnOrAfter value (if present), whichever is shorter.</p><p>If SessionNotOnOrAfter is in the past then token creation fails, and the app must somehow force the user to reauthenticate.</p><p>For efficiency consumers should cache the tokens returned by this endpoint until (a) the tenant&#39;s security generation number changes, or (b) the cached token is too close to expiry to serve the needs of the consumer.</p></div><div class="clearfix"></div></div></div></div></div><div class="modal fade" tabindex="0" id="token_post"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="myModalLabel"><span class="badge badge_post">post</span> <span class="parent"></span>/token</h4></div><div class="modal-body"><div class="alert alert-info"><p>Get a new access token, and optionally a refresh token.</p><p>The request body must be of content-type application/x-www-form-urlencoded, and contain values for grant_type and optionally other parameters, encoded as per <a href="https://tools.ietf.org/html/rfc6749#appendix-B">https://tools.ietf.org/html/rfc6749#appendix-B</a>. See also <a href="https://tools.ietf.org/html/rfc7522#section-4">https://tools.ietf.org/html/rfc7522#section-4</a>.</p><p>The core asserts that:</p><ul><li>the consuming app is installed at the consuming tenant</li><li>the producing app is installed at the producing tenant</li><li>there exists a route between the consumer and producer, for this API, consumed as SoT or not as relevant (this prevents malicious apps probing for the presence of other apps)</li><li>when a SAML assertion is passed directly or by key, that the assertion was issued to this application and not any other</li><li>if the API is on-behalf (is linked to a principal type) that one of the following grant types is being used:<ul><li>urn:ietf:params:oauth:client-assertion-type:saml2-bearer</li><li>urn:talentappstore.com:oauth:saml2-bearer-key</li><li>urn:talentappstore.com:oauth:tas-inherited</li><li>refresh_token</li></ul></li><li>if the API is not on-behalf (is linked to a principal type) that one of the following grant types is being used:<ul><li>client_credentials</li></ul></li></ul><p>Every call to this endpoint results in a new access token being issued, with an expiry time set to one hour, or (as per <a href="http://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRoleWithSAML.html">http://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRoleWithSAML.html</a>) to the time specified in the SAML assertion&#39;s SessionNotOnOrAfter value (if present), whichever is shorter.</p><p>If SessionNotOnOrAfter is in the past then token creation fails, and the app must somehow force the user to reauthenticate.</p><p>For efficiency consumers should cache the tokens returned by this endpoint until (a) the tenant&#39;s security generation number changes, or (b) the cached token is too close to expiry to serve the needs of the consumer.</p></div><ul class="nav nav-tabs"><li class="active"><a href="#token_post_request" data-toggle="tab">Request</a></li><li><a href="#token_post_response" data-toggle="tab">Response</a></li></ul><div class="tab-content"><div class="tab-pane active" id="token_post_request"><h3>Body</h3><p><strong>Type: application/x-www-form-urlencoded</strong></p><strong>Form Parameters</strong><ul><li><strong>grant_type</strong>: <em>(string)</em><p>One of:</p><ul><li><strong>client_credentials</strong>: for an anonymous OAuth tokens that is not on behalf of any user/principal. Anonymous tokens are easy to create, but can&#39;t be used to consume on-behalf APIs, which tend to be those with principal-specific logic or security, e.g. only allowing users in the finance department to view account details, logging who the user was who created a job, etc. Anonymous access tokens always expire one hour after they are issued.</li><li><strong>urn:ietf:params:oauth:client-assertion-type:saml2-bearer</strong>: for an on-behalf OAuth token that includes the identity of the user/principal who is the subject of the passed in SAML assertion. This grant type can only be used by apps that are protected via SSO. The token&#39;s expiry time will be either in one hour, or at the time dictated by the original SAML assertion&#39;s "SessionNotOnOrAfter" field, whichever is sooner.</li><li><strong>urn:talentappstore.com:oauth:saml2-bearer-key</strong>: As for urn:ietf:params:oauth:client-assertion-type:saml2-bearer, except that the key is used rather than the assertion itself.</li><li><strong>urn:talentappstore.com:oauth:tas-inherited</strong>: for an on-behalf token that re-uses the user&#39;s identity from an incoming on-behalf token. Used by apps that both produce and consume on-behalf APIs; i.e. apps that are intermediate links in a chain of on-behalf API calls. The new access token inherits details of the principal (if any) and the expiry time from the parent access token. This means all access tokens created as part of a nested set of API calls will expire simultaneously.</li><li><strong>refresh_token</strong>: for an on-behalf token derived from a refresh token obtained previously via a call to the token endpoint with scope of "offline". The access token has a life of one hour.</li></ul><p><strong>Example</strong>:</p><pre>urn:talentappstore.com:oauth:saml2-bearer-key</pre></li><li><strong>scope</strong>: <em>(string)</em><p>A space separated set of values for the OAuth scope of this token, which may include:</p><ul><li>A space separated string denoting a consuming app installed at a specific tenant, a producing app installed at a specific tenant, the URI template of the API (as per <a href="https://tools.ietf.org/html/rfc6570">https://tools.ietf.org/html/rfc6570</a>) being consumed; for example "acme jobboard acme ats /jobs/{job}", and whether the API is being consumed as SoT or not. (MUST be present for all grant types other than refresh_token)</li><li>the keyword "offline" (MAY be present only when grant_type is urn:ietf:params:oauth:client-assertion-type:saml2-bearer)</li></ul><p>The scope string is then encoded as per section 17.13.4 of <a href="http://www.w3.org/TR/html401/interact/forms.html">http://www.w3.org/TR/html401/interact/forms.html</a> - specifically "space characters are replaced by &#39;+&#39;, and then reserved characters are escaped as described in [RFC1738].".</p><p>So:</p><p>"acme jobboard acme ats /jobs/{job} true offline"</p><p>becomes</p><p>"acme+jobboard+acme+ats+%2fjobs%2f%7bjob%7d+true+offline"</p><p><strong>Example</strong>:</p><pre>acme+jobboard+acme+ats+%2fjobs%2f%7bjob%7d+true+offline</pre></li><li><strong>principal_type</strong>: <em>(string)</em><p>The principal type the on-behalf token is being created for. MUST be present when grant_type is urn:ietf:params:oauth:client-assertion-type:saml2-bearer or urn:talentappstore.com:oauth:saml2-bearer-key. MUST NOT be present for other grant types.</p><p><strong>Example</strong>:</p><pre>candidate</pre></li><li><strong>refresh_token</strong>: <em>(string)</em><p>A refresh token obtained via a previous call to this endpoint with scope of offline. MUST be present when grant_type is refresh_token. MUST NOT be present for other grant types.</p></li><li><strong>parent_token</strong>: <em>(string)</em><p>An access token passed in to the consuming app. MUST be present when grant_type is urn:talentappstore.com:oauth2:tas-inherited. MUST NOT be present for other grant types.</p></li><li><strong>assertion</strong>: <em>(string)</em><p>The incoming SAML assertion. MUST be present for grant_type of urn:ietf:params:oauth:client-assertion-type:saml2-bearer. MUST NOT be present for other grant types. MUST contain an unexpired SAML assertion that matches exactly one as captured and stored by the TAS SAML proxy during login to <em>this app</em>.</p></li><li><strong>samlKey</strong>: <em>(string)</em><p>A reference to the incoming SAML assertion. MUST be present for grant_type of urn:talentappstore.com:oauth:saml2-bearer-ref. MUST NOT be present for other grant types. MUST contain a valid reference to an unexpired SAML assertion as captured and stored by the TAS SAML proxy during login <em>to this app</em>.</p></li></ul></div><div class="tab-pane" id="token_post_response"><h2>HTTP status code <a href="http://httpstatus.es/200" target="_blank">200</a></h2><h3>Body</h3><p><strong>Type: application/json</strong></p><p><strong>Schema</strong>:</p><pre><code>{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "type": "object",
    "additionalProperties": false,
    "description": "result of a call to POST /token",
    "properties": {
        "access_token": {
            "type": "string",
            "description": "the token (a JWT signed by the core and with the structure described in the schema tokenJwt.json)"
        },
        "expires_in": {
            "type": "integer",
            "description": "The remaining lifetime of the access token, in seconds"
        },
        "token_type": {
            "enum": [
                "Bearer"
            ]
        },
        "refresh_token": {
            "type": "string",
            "description": "An optional refresh token, when the response was a result of a call to POST /token with scope of offline"
        }
    },
    "required": [
        "access_token",
        "expires_in",
        "token_type"
    ]
}</code></pre><p><strong>Example</strong>:</p><pre><code>{
  "access_token":"iuhy76YT785L0GDF23JH7kjhd",
  "expires_in":3600,
  "token_type":"Bearer",
  "refresh_token":"j089777bhkltyHTRFG78969KJH968d"
}</code></pre></div></div></div></div></div></div></div></div></div></div></div><div class="col-md-3"><div id="sidebar" class="hidden-print affix" role="complementary"><ul class="nav nav-pills nav-stacked"><li><a href="#OAuthPublicKey">/OAuthPublicKey</a></li><li><a href="#patchSets">/patchSets</a></li><li><a href="#ping">/ping</a></li><li><a href="#routes">/routes</a></li><li><a href="#samlIdPMetadata">/samlIdPMetadata</a></li><li><a href="#tenants">/tenants</a></li><li><a href="#token">/token</a></li></ul></div></div></div></div></body></html>