{
  "$schema":"http://json-schema.org/draft-04/schema#",
  "definitions":{
    "basicAuthCredentials":{
      "type":"object",
      "additionalProperties":false,
      "required":[
        "user",
        "password"
      ],
      "properties":{
        "user":{
          "type":"string"
        },
        "password":{
          "type":"string"
        }
      }
    },
    "server":{
      "type":"object",
      "additionalProperties":false,
      "required":[
        "name",
        "baseUri",
        "basicAuthCredentials"
      ],
      "properties":{
        "name":{
          "type":"string"
        },
        "baseUri":{
          "type":"string"
        },
        "basicAuthCredentials":{
          "$ref":"#/definitions/basicAuthCredentials"
        }
      }
    },
    "servers":{
      "type":"array",
      "items":{
        "$ref":"#/definitions/server"
      }
    },
    "app":{
      "type":"string"
    },
    "installDelta":{
      "type":"object",
      "additionalProperties":false,
      "required":[
        "kind",
        "app"
      ],
      "properties":{
        "kind":{
          "enum":[
            "installDelta"
          ]
        },
        "app":{
          "$ref":"#/definitions/app"
        },
        "servers":{
          "$ref":"#/definitions/servers"
        }
      }
    },
    "editDelta":{
      "type":"object",
      "additionalProperties":false,
      "required":[
        "kind",
        "app"
      ],
      "properties":{
        "kind":{
          "enum":[
            "editDelta"
          ]
        },
        "app":{
          "$ref":"#/definitions/app"
        },
        "servers":{
          "$ref":"#/definitions/servers"
        }
      }
    },
    "unInstallDelta":{
      "type":"object",
      "additionalProperties":false,
      "required":[
        "kind",
        "app"
      ],
      "properties":{
        "kind":{
          "enum":[
            "unInstallDelta"
          ]
        },
        "app":{
          "$ref":"#/definitions/app"
        }
      }
    }
  },
  "type":"object",
  "description":"A set (usually with just one item in it) of deltas to be applied to the installed apps for a tenant, i.e. a sequence of installs, edits and uninstalls. Pass an empty set of deltas to simply reboot the tenant.",
  "additionalProperties":false,
  "required":[
    "kind",
    "targetIncarnation",
    "items"
  ],
  "properties":{
    "kind":{
      "enum":[
        "deltaSet"
      ],
      "description":"always set to: deltaSet"
    },
    "targetIncarnation":{
      "type":"integer",
      "description":"The incarnation that these deltas are for. Applying the set will fail if the tenant is not currently at this incarnation (i.e. someone else has applied a different set in the meantime)."
    },
    "items":{
      "type":"array",
      "items":{
        "oneOf":[
          {
            "$ref":"#/definitions/installDelta"
          },
          {
            "$ref":"#/definitions/editDelta"
          },
          {
            "$ref":"#/definitions/unInstallDelta"
          }
        ]
      }
    }
  }
}