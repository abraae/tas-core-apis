{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "definitions": {
        "basicAuthCredentials": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "user",
                "password"
            ],
            "properties": {
                "user": {
                    "type": "string"
                },
                "password": {
                    "type": "string"
                }
            }
        },
        "server": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "name",
                "baseUri",
                "basicAuthCredentials"
            ],
            "properties": {
                "name": {
                    "type": "string"
                },
                "baseUri": {
                    "type": "string"
                },
                "basicAuthCredentials": {
                    "$ref": "#/definitions/basicAuthCredentials"
                }
            }
        },
        "servers": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/server"
            }
        },
        "app": {
            "type": "string"
        },
        "installDelta": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "kind",
                "app"
            ],
            "properties": {
                "kind": {
                    "enum": [
                        "installDelta"
                    ]
                },
                "app": {
                    "$ref": "#/definitions/app"
                },
                "servers": {
                    "$ref": "#/definitions/servers"
                }
            }
        },
        "editDelta": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "kind",
                "app"
            ],
            "properties": {
                "kind": {
                    "enum": [
                        "editDelta"
                    ]
                },
                "app": {
                    "$ref": "#/definitions/app"
                },
                "servers": {
                    "$ref": "#/definitions/servers"
                }
            }
        },
        "unInstallDelta": {
            "type": "object",
            "additionalProperties": false,
            "required": [
                "kind",
                "app"
            ],
            "properties": {
                "kind": {
                    "enum": [
                        "unInstallDelta"
                    ]
                },
                "app": {
                    "$ref": "#/definitions/app"
                }
            }
        }
    },
    "type": "object",
    "description": "A set (usually with just one item in it) of deltas to be applied to the installed apps for a tenant, i.e. a sequence of installs, edits and uninstalls. Pass an empty set of deltas to simply reboot the tenant.",
    "additionalProperties": false,
    "required": [ "kind" ],
    "properties": {
        "kind": {
            "enum": [
                "deltaSet"
            ],
            "description": "always set to: deltaSet"
        },
        "existingTenantTarget" :
          { "$ref": "./tenant.json" },
        "newTenantTarget":
          { "$ref": "./tenant.json" },
        "restartPage": {
            "type": "string",
            "description": "The URI that the user should be returned to once the delta set has been applied. Usually the storeFront app should set this to whichever page the lauch was made from, e.g. the app details page where the user clicked install. This URI will be passed through to the deltaSetStatus object, allowing javascript to access it once the apply is complete. However if the delta set swapped out the current storeFront app, then TAS will discard this URI (since most likely the page no longer exists) and instead populate the deltaSetStatus object by calling the outwards core API GET /storeFrontMainPage."
        },
        "appDeltas": {
            "type": "array",
            "items": {
                "oneOf": [
                    {
                        "$ref": "#/definitions/installDelta"
                    },
                    {
                        "$ref": "#/definitions/editDelta"
                    },
                    {
                        "$ref": "#/definitions/unInstallDelta"
                    }
                ]
            }
        },
        "identitySourceDeltas": {
          "type": "array",
          "items": { "$ref": "./identitySourceSet.json" }
        }
    }
}